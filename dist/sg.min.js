(function(t,e){"use strict";function i(t){return t?(t^Math.random()*16>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,i)}let r=e.vec3.create();let n=e.quat.create();let s=e.mat3.create();let h=e.mat3.create();let l=e.mat4.create();class a{constructor(t){this._id=i();this._parent=null;this._children=[];this.name=t||"";this.lpos=e.vec3.new(0,0,0);this.lscale=e.vec3.new(1,1,1);this.lrot=e.quat.new(0,0,0,1)}get id(){return this._id}get parent(){return this._parent}get children(){return this._children}setParent(t){let e=this._parent;if(e===t){return false}let i=t;while(i){if(i===this){return false}i=i._parent}if(e){let t=e._children.length;for(let i=0;i<t;++i){if(e._children[i]===this){e._children.splice(i,1);break}}}this._parent=t;if(t){t._children.push(this)}return true}insertAt(t,e){if(!e){return false}let i=this;while(i){if(i===e){return false}i=i._parent}let r=e._parent;let n=this._children.length;t=t<0?0:t>n?n:t;if(r){n=r._children.length;for(let i=0;i<n;++i){if(r._children[i]===e){if(r===this){if(i===t||i===t-1){return false}if(i<t-1){t=t-1}}r._children.splice(i,1);break}}}e._parent=this;this._children.splice(t,0,e);return true}append(t){if(!t){return false}let e=this;while(e){if(e===t){return false}e=e._parent}let i=t._parent;if(i){let e=i._children.length;for(let r=0;r<e;++r){if(i._children[r]===t){if(i===this&&r===e-1){return false}i._children.splice(r,1);break}}}t._parent=this;this._children.push(t);return true}remove(){if(this._parent){this._parent.removeChild(this)}}removeChild(t){let e=this._children.length;for(let i=0;i<e;++i){if(this._children[i]===t){this._children.splice(i,1);t._parent=null;return true}}return false}getWorldPos(t){e.vec3.copy(t,this.lpos);let i=this._parent;while(i){e.vec3.mul(t,t,i.lscale);e.mat3.fromQuat(s,i.lrot);e.vec3.transformMat3(t,t,s);e.vec3.add(t,i.lpos);i=i._parent}return t}setWorldPos(t){if(this._parent){this._parent.invTransformPoint(this.lpos,t);return}e.vec3.copy(this.lpos,t)}getWorldRot(t){e.vec3.copy(t,this.lrot);let i=this._parent;while(i){e.quat.mul(t,i.lrot,t);i=i._parent}return t}setWorldRot(t){if(this._parent){this._parent.getWorldRot(this.lrot);e.quat.invert(this.lrot);e.quat.mul(this.lrot,t,this.lrot);return}e.quat.copy(this.lrot,t)}getWorldScale(t){this.getWorldRot(n);e.quat.invert(n,n);e.mat3.fromQuat(t,n);this._getWorldRS(s);e.mat3.mul(t,t,s);return t}invTransformPoint(t,i){if(this._parent){this._parent.invTransformPoint(t,i)}else{e.vec3.copy(t,i)}e.vec3.sub(t,t,this.lpos);e.quat.invert(n,this.lrot);e.mat3.fromQuat(s,n);e.vec3.transformMat3(t,t,s);e.vec3.inverseSafe(r,this.lscale);e.vec3.mul(t,t,r);return t}getLocalMatrix(t){e.mat4.fromRTS(t,this.lrot,this.lpos,this.lscale);return t}getWorldMatrix(t){this.getLocalMatrix(t);let i=this._parent;while(i){i.getLocalMatrix(l);e.mat4.mul(t,l,t);i=i._parent}return t}_getWorldRS(t){e.mat3.set(s,this.lscale.x,0,0,0,this.lscale.y,0,0,0,this.lscale.z);e.mat3.fromQuat(h,this.lrot);if(this._parent){this._parent._getWorldRS(t);e.mat3.mul(t,t,h);e.mat3.mul(t,t,s)}else{e.mat3.mul(t,h,s)}return t}}function u(t,e){t.children.forEach(i=>{e(i,t);u(i,e)})}function c(t){let e=[];e.push(t);u(t,t=>{e.push(t)});return e}let o={walk:u,flat:c};t.Node=a;t.utils=o})(this.sg=this.sg||{},window.vmath);
//# sourceMappingURL=./dist/sg.min.js.map