(function(t,e){"use strict";function r(t){return t?(t^Math.random()*16>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,r)}let n=e.vec3.create();let i=e.quat.create();let l=e.mat3.create();let s=e.mat3.create();let h=e.mat4.create();class a{constructor(t){this._id=r();this._parent=null;this._children=[];this.name=t||"";this.lpos=e.vec3.new(0,0,0);this.lscale=e.vec3.new(1,1,1);this.lrot=e.quat.new(0,0,0,1)}get id(){return this._id}get parent(){return this._parent}get children(){return this._children}clone(t){let r=new a;r.name=this.name;e.vec3.copy(r.lpos,this.lpos);e.vec3.copy(r.lscale,this.lscale);e.quat.copy(r.lrot,this.lrot);if(t){t(r,this)}return r}deepClone(t){let e=this.clone(t);e._children=new Array(this._children.length);for(let r=0;r<this._children.length;++r){let n=this._children[r];let i=n.deepClone(t);e._children[r]=i;i._parent=e}return e}setParent(t){let e=this._parent;if(e===t){return false}let r=t;while(r){if(r===this){return false}r=r._parent}if(e){let t=e._children.length;for(let r=0;r<t;++r){if(e._children[r]===this){e._children.splice(r,1);break}}}this._parent=t;if(t){t._children.push(this)}return true}insertAt(t,e){if(!e){return false}let r=this;while(r){if(r===e){return false}r=r._parent}let n=e._parent;let i=this._children.length;t=t<0?0:t>i?i:t;if(n){i=n._children.length;for(let r=0;r<i;++r){if(n._children[r]===e){if(n===this){if(r===t||r===t-1){return false}if(r<t-1){t=t-1}}n._children.splice(r,1);break}}}e._parent=this;this._children.splice(t,0,e);return true}append(t){if(!t){return false}let e=this;while(e){if(e===t){return false}e=e._parent}let r=t._parent;if(r){let e=r._children.length;for(let n=0;n<e;++n){if(r._children[n]===t){if(r===this&&n===e-1){return false}r._children.splice(n,1);break}}}t._parent=this;this._children.push(t);return true}remove(){if(this._parent){this._parent.removeChild(this)}}removeChild(t){let e=this._children.length;for(let r=0;r<e;++r){if(this._children[r]===t){this._children.splice(r,1);t._parent=null;return true}}return false}getWorldPos(t){e.vec3.copy(t,this.lpos);let r=this._parent;while(r){e.vec3.mul(t,t,r.lscale);e.vec3.transformQuat(t,t,r.lrot);e.vec3.add(t,t,r.lpos);r=r._parent}return t}setWorldPos(t){if(this._parent){this._parent.invTransformPoint(this.lpos,t);return}e.vec3.copy(this.lpos,t)}getWorldRot(t){e.quat.copy(t,this.lrot);let r=this._parent;while(r){e.quat.mul(t,r.lrot,t);r=r._parent}return t}setWorldRot(t){if(this._parent){this._parent.getWorldRot(this.lrot);e.quat.conjugate(this.lrot,this.lrot);e.quat.mul(this.lrot,this.lrot,t);return}e.quat.copy(this.lrot,t)}getWorldScale(t){this.getWorldRot(i);e.quat.conjugate(i,i);e.mat3.fromQuat(t,i);this._getWorldRS(l);e.mat3.mul(t,t,l);return t}invTransformPoint(t,r){if(this._parent){this._parent.invTransformPoint(t,r)}else{e.vec3.copy(t,r)}e.vec3.sub(t,t,this.lpos);e.quat.conjugate(i,this.lrot);e.vec3.transformQuat(t,t,i);e.vec3.inverseSafe(n,this.lscale);e.vec3.mul(t,t,n);return t}getLocalMatrix(t){e.mat4.fromRTS(t,this.lrot,this.lpos,this.lscale);return t}getWorldMatrix(t){this.getLocalMatrix(t);let r=this._parent;while(r){r.getLocalMatrix(h);e.mat4.mul(t,h,t);r=r._parent}return t}_getWorldRT(t){this._getWorldPosAndRot(n,i);e.mat4.fromRT(t,i,n);return t}_getWorldRS(t){e.mat3.set(l,this.lscale.x,0,0,0,this.lscale.y,0,0,0,this.lscale.z);e.mat3.fromQuat(s,this.lrot);if(this._parent){this._parent._getWorldRS(t);e.mat3.mul(t,t,s);e.mat3.mul(t,t,l)}else{e.mat3.mul(t,s,l)}return t}_getWorldPosAndRot(t,r){e.vec3.copy(t,this.lpos);e.quat.copy(r,this.lrot);let n=this._parent;while(n){e.vec3.mul(t,t,n.lscale);e.vec3.transformQuat(t,t,n.lrot);e.vec3.add(t,t,n.lpos);e.quat.mul(r,n.lrot,r);n=n._parent}}}function c(t,e){t.children.forEach(r=>{let n=e(r,t);if(n!==false){c(r,e)}})}function o(t){let e=[];e.push(t);c(t,t=>{e.push(t)});return e}function u(t,e){e.remove();let r=t._parent;if(!r){return}t._parent=null;e._parent=r;let n=r._children.length;for(let i=0;i<n;++i){if(r._children[i]===t){r._children[i]=e;return}}}let f={walk:c,flat:o,replace:u};t.Node=a;t.utils=f})(this.sgraph=this.sgraph||{},window.vmath);
//# sourceMappingURL=./dist/scene-graph.min.js.map