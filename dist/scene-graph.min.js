(function(t,e){"use strict";function r(t){return t?(t^Math.random()*16>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,r)}let i=e.vec3.create();let n=e.quat.create();let s=e.mat3.create();let l=e.mat3.create();let h=e.mat4.create();class a{constructor(t){this._id=r();this._parent=null;this._children=[];this.name=t||"";this.lpos=e.vec3.new(0,0,0);this.lscale=e.vec3.new(1,1,1);this.lrot=e.quat.new(0,0,0,1)}get id(){return this._id}get parent(){return this._parent}get children(){return this._children}setParent(t){let e=this._parent;if(e===t){return false}let r=t;while(r){if(r===this){return false}r=r._parent}if(e){let t=e._children.length;for(let r=0;r<t;++r){if(e._children[r]===this){e._children.splice(r,1);break}}}this._parent=t;if(t){t._children.push(this)}return true}insertAt(t,e){if(!e){return false}let r=this;while(r){if(r===e){return false}r=r._parent}let i=e._parent;let n=this._children.length;t=t<0?0:t>n?n:t;if(i){n=i._children.length;for(let r=0;r<n;++r){if(i._children[r]===e){if(i===this){if(r===t||r===t-1){return false}if(r<t-1){t=t-1}}i._children.splice(r,1);break}}}e._parent=this;this._children.splice(t,0,e);return true}append(t){if(!t){return false}let e=this;while(e){if(e===t){return false}e=e._parent}let r=t._parent;if(r){let e=r._children.length;for(let i=0;i<e;++i){if(r._children[i]===t){if(r===this&&i===e-1){return false}r._children.splice(i,1);break}}}t._parent=this;this._children.push(t);return true}remove(){if(this._parent){this._parent.removeChild(this)}}removeChild(t){let e=this._children.length;for(let r=0;r<e;++r){if(this._children[r]===t){this._children.splice(r,1);t._parent=null;return true}}return false}getWorldPos(t){e.vec3.copy(t,this.lpos);let r=this._parent;while(r){e.vec3.mul(t,t,r.lscale);e.vec3.transformQuat(t,t,r.lrot);e.vec3.add(t,t,r.lpos);r=r._parent}return t}setWorldPos(t){if(this._parent){this._parent.invTransformPoint(this.lpos,t);return}e.vec3.copy(this.lpos,t)}getWorldRot(t){e.quat.copy(t,this.lrot);let r=this._parent;while(r){e.quat.mul(t,r.lrot,t);r=r._parent}return t}setWorldRot(t){if(this._parent){this._parent.getWorldRot(this.lrot);e.quat.conjugate(this.lrot,this.lrot);e.quat.mul(this.lrot,this.lrot,t);return}e.quat.copy(this.lrot,t)}getWorldScale(t){this.getWorldRot(n);e.quat.conjugate(n,n);e.mat3.fromQuat(t,n);this._getWorldRS(s);e.mat3.mul(t,t,s);return t}invTransformPoint(t,r){if(this._parent){this._parent.invTransformPoint(t,r)}else{e.vec3.copy(t,r)}e.vec3.sub(t,t,this.lpos);e.quat.conjugate(n,this.lrot);e.vec3.transformQuat(t,t,n);e.vec3.inverseSafe(i,this.lscale);e.vec3.mul(t,t,i);return t}getLocalMatrix(t){e.mat4.fromRTS(t,this.lrot,this.lpos,this.lscale);return t}getWorldMatrix(t){this.getLocalMatrix(t);let r=this._parent;while(r){r.getLocalMatrix(h);e.mat4.mul(t,h,t);r=r._parent}return t}_getWorldRT(t){this._getWorldPosAndRot(i,n);e.mat4.fromRT(t,n,i);return t}_getWorldRS(t){e.mat3.set(s,this.lscale.x,0,0,0,this.lscale.y,0,0,0,this.lscale.z);e.mat3.fromQuat(l,this.lrot);if(this._parent){this._parent._getWorldRS(t);e.mat3.mul(t,t,l);e.mat3.mul(t,t,s)}else{e.mat3.mul(t,l,s)}return t}_getWorldPosAndRot(t,r){e.vec3.copy(t,this.lpos);e.quat.copy(r,this.lrot);let i=this._parent;while(i){e.vec3.mul(t,t,i.lscale);e.vec3.transformQuat(t,t,i.lrot);e.vec3.add(t,t,i.lpos);e.quat.mul(r,i.lrot,r);i=i._parent}}}function u(t,e){t.children.forEach(r=>{e(r,t);u(r,e)})}function c(t){let e=[];e.push(t);u(t,t=>{e.push(t)});return e}let o={walk:u,flat:c};t.Node=a;t.utils=o})(this.sgraph=this.sgraph||{},window.vmath);
//# sourceMappingURL=./dist/scene-graph.min.js.map